
<!DOCTYPE html>
<html lang="pt"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin — LUMI Apex</title>
<style>body{font-family:Inter,system-ui,sans-serif;background:#0f1220;color:#e9ecff;margin:0} .wrap{max-width:1100px;margin:20px auto;padding:0 12px} .card{background:#171a2b;border:1px solid #262a44;border-radius:16px;padding:12px;margin-bottom:12px} input,select,button{background:#222641;border:1px solid #2e335a;color:#e9ecff;border-radius:10px;padding:8px}</style>
</head><body>
<div class="wrap">
  <div class="card">
    <h2>Sessão</h2>
    <input id="token" placeholder="Bearer token" style="width:100%">
  </div>
  <div class="card">
    <h2>Denúncias</h2>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <select id="source"><option value="">(qualquer fonte)</option><option>ai</option><option>user</option></select>
      <select id="reason"><option value="">(qualquer razão)</option><option>toxicity</option><option>abuso</option><option>bullying</option><option>nudez</option><option>spam</option><option>outros</option></select>
      <input id="minScore" type="number" step="0.1" placeholder="min score (0..1)" style="width:160px">
      <button onclick="loadReports()">Filtrar</button>
      <button onclick="batch()">Executar batch</button>
    </div>
    <div id="reports" style="margin-top:8px"></div>
  </div>
</div>
<script>
const API=(p)=>'http://localhost:4000'+p;
function hdr(){ return {'Authorization':'Bearer '+document.getElementById('token').value.trim(),'Content-Type':'application/json'}; }
let selected = new Set();
async function loadReports(){
  const params=new URLSearchParams(); const s=document.getElementById('source').value.trim(); const r=document.getElementById('reason').value.trim(); const m=document.getElementById('minScore').value.trim(); if(s) params.set('source',s); if(r) params.set('reason',r); if(m) params.set('minScore',m);
  const res=await fetch(API('/admin/reports?'+params.toString()),{headers:hdr()}); const list=await res.json(); const box=document.getElementById('reports'); box.innerHTML='';
  list.forEach(rep=>{ const el=document.createElement('div'); el.style='border-top:1px solid #2d3054;padding:8px 0;display:flex;gap:8px;align-items:center';
    const id=rep.id; el.innerHTML='<input type="checkbox" onchange="sel(\''+id+'\',this.checked)"><b>'+rep.reason+'</b> ['+rep.source+'] score='+(rep.score||0)+' — <small>'+rep.targetId+'</small>'; box.appendChild(el); });
}
function sel(id, on){ if(on) selected.add(id); else selected.delete(id); }
async function batch(){
  const ids=[...selected]; if(!ids.length) return alert('Selecione denúncias e edite manualmente ação conforme o alvo.');
  // Exemplo: remover posts com targetId 'post:<id>'
  const acts=[]; document.querySelectorAll('#reports div').forEach(div=>{
    const text=div.textContent||''; const match=text.match(/post:([a-z0-9]+)/); if(match){ acts.push({ type:'remove_post', id: match[1] }); }
  });
  if(!acts.length) return alert('Nenhum post detectado nos alvos selecionados.');
  const r=await fetch(API('/admin/batch'),{method:'POST',headers:hdr(),body:JSON.stringify({actions:acts})}); alert(await r.text()); loadReports();
}
</script>
</body></html>
